# 网页端文献管理系统RESTful API设计

## 1. API设计原则

- **RESTful架构**：遵循REST设计风格，使用HTTP方法表示操作类型
- **清晰的资源命名**：使用名词表示资源，动词表示操作
- **统一的响应格式**：所有API返回统一的JSON格式
- **适当的状态码**：使用HTTP状态码表示请求结果
- **版本控制**：在URL中包含API版本号
- **认证和授权**：使用JWT进行认证，保护敏感资源

## 2. API版本和基础URL

- **API版本**：v1
- **基础URL**：`http://localhost:3000/api/v1`

## 3. 认证API

### 3.1 用户注册
- **URL**：`/auth/register`
- **方法**：`POST`
- **请求体**：
  ```json
  {
    "username": "string",
    "email": "string",
    "password": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "注册成功",
    "token": "jwt-token",
    "user": {
      "id": "user-id",
      "username": "string",
      "email": "string",
      "role": "user"
    }
  }
  ```

### 3.2 用户登录
- **URL**：`/auth/login`
- **方法**：`POST`
- **请求体**：
  ```json
  {
    "email": "string",
    "password": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "登录成功",
    "token": "jwt-token",
    "user": {
      "id": "user-id",
      "username": "string",
      "email": "string",
      "role": "user"
    }
  }
  ```

### 3.3 获取当前用户信息
- **URL**：`/auth/me`
- **方法**：`GET`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "user": {
      "id": "user-id",
      "username": "string",
      "email": "string",
      "role": "user"
    }
  }
  ```

### 3.4 更新用户信息
- **URL**：`/auth/me`
- **方法**：`PUT`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "username": "string",
    "email": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "用户信息更新成功",
    "user": {
      "id": "user-id",
      "username": "string",
      "email": "string",
      "role": "user"
    }
  }
  ```

### 3.5 更改密码
- **URL**：`/auth/change-password`
- **方法**：`PUT`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "currentPassword": "string",
    "newPassword": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "密码更改成功"
  }
  ```

## 4. 文献管理API

### 4.1 获取文献列表
- **URL**：`/documents`
- **方法**：`GET`
- **认证**：需要JWT token
- **查询参数**：
  - `page`：页码，默认1
  - `limit`：每页数量，默认10
  - `search`：搜索关键词
  - `status`：状态过滤（未读/已读/重点）
  - `sortBy`：排序字段，默认createdAt
  - `sortOrder`：排序顺序，asc/desc，默认desc
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "documents": [
        {
          "_id": "document-id",
          "title": "string",
          "authors": ["string"],
          "journal": "string",
          "year": 2023,
          "doi": "string",
          "status": "未读",
          "rating": 4,
          "tags": ["string"],
          "createdAt": "2023-10-27T00:00:00.000Z",
          "updatedAt": "2023-10-27T00:00:00.000Z"
        }
      ],
      "pagination": {
        "total": 100,
        "page": 1,
        "limit": 10,
        "pages": 10
      }
    }
  }
  ```

### 4.2 添加新文献
- **URL**：`/documents`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "title": "string",
    "authors": ["string"],
    "journal": "string",
    "year": 2023,
    "doi": "string",
    "abstract": "string",
    "keywords": ["string"],
    "status": "未读",
    "rating": 3,
    "tags": ["string"]
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "文献添加成功",
    "data": {
      "_id": "document-id",
      "title": "string",
      "authors": ["string"],
      "journal": "string",
      "year": 2023,
      "doi": "string",
      "abstract": "string",
      "keywords": ["string"],
      "status": "未读",
      "rating": 3,
      "tags": ["string"],
      "owner": "user-id",
      "createdAt": "2023-10-27T00:00:00.000Z",
      "updatedAt": "2023-10-27T00:00:00.000Z"
    }
  }
  ```

### 4.3 获取单个文献详情
- **URL**：`/documents/:id`
- **方法**：`GET`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "_id": "document-id",
      "title": "string",
      "authors": ["string"],
      "journal": "string",
      "year": 2023,
      "doi": "string",
      "abstract": "string",
      "keywords": ["string"],
      "status": "未读",
      "rating": 3,
      "tags": ["string"],
      "pdfPath": "string",
      "owner": "user-id",
      "createdAt": "2023-10-27T00:00:00.000Z",
      "updatedAt": "2023-10-27T00:00:00.000Z"
    }
  }
  ```

### 4.4 更新文献信息
- **URL**：`/documents/:id`
- **方法**：`PUT`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "title": "string",
    "authors": ["string"],
    "journal": "string",
    "year": 2023,
    "doi": "string",
    "abstract": "string",
    "keywords": ["string"],
    "status": "已读",
    "rating": 5,
    "tags": ["string"]
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "文献更新成功",
    "data": {
      "_id": "document-id",
      "title": "string",
      "authors": ["string"],
      "journal": "string",
      "year": 2023,
      "doi": "string",
      "abstract": "string",
      "keywords": ["string"],
      "status": "已读",
      "rating": 5,
      "tags": ["string"],
      "pdfPath": "string",
      "owner": "user-id",
      "createdAt": "2023-10-27T00:00:00.000Z",
      "updatedAt": "2023-10-28T00:00:00.000Z"
    }
  }
  ```

### 4.5 删除文献
- **URL**：`/documents/:id`
- **方法**：`DELETE`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "message": "文献删除成功"
  }
  ```

### 4.6 批量删除文献
- **URL**：`/documents/batch-delete`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "ids": ["document-id-1", "document-id-2"]
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "批量删除成功",
    "data": {
      "deletedCount": 2
    }
  }
  ```

### 4.7 上传PDF文件
- **URL**：`/documents/:id/upload-pdf`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：FormData，包含pdf文件
- **响应**：
  ```json
  {
    "success": true,
    "message": "PDF上传成功",
    "data": {
      "pdfPath": "string"
    }
  }
  ```

### 4.8 下载PDF文件
- **URL**：`/documents/:id/download-pdf`
- **方法**：`GET`
- **认证**：需要JWT token
- **响应**：PDF文件流

## 5. 笔记管理API

### 5.1 获取文献笔记
- **URL**：`/documents/:id/notes`
- **方法**：`GET`
- **认证**：需要JWT token
- **查询参数**：
  - `page`：页码，默认1
  - `limit`：每页数量，默认10
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "notes": [
        {
          "_id": "note-id",
          "content": "string",
          "document": "document-id",
          "user": "user-id",
          "page": 1,
          "createdAt": "2023-10-27T00:00:00.000Z",
          "updatedAt": "2023-10-27T00:00:00.000Z"
        }
      ],
      "pagination": {
        "total": 5,
        "page": 1,
        "limit": 10,
        "pages": 1
      }
    }
  }
  ```

### 5.2 添加笔记
- **URL**：`/notes`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "content": "string",
    "document": "document-id",
    "page": 1
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "笔记添加成功",
    "data": {
      "_id": "note-id",
      "content": "string",
      "document": "document-id",
      "user": "user-id",
      "page": 1,
      "createdAt": "2023-10-27T00:00:00.000Z",
      "updatedAt": "2023-10-27T00:00:00.000Z"
    }
  }
  ```

### 5.3 更新笔记
- **URL**：`/notes/:id`
- **方法**：`PUT`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "content": "string",
    "page": 2
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "笔记更新成功",
    "data": {
      "_id": "note-id",
      "content": "string",
      "document": "document-id",
      "user": "user-id",
      "page": 2,
      "createdAt": "2023-10-27T00:00:00.000Z",
      "updatedAt": "2023-10-28T00:00:00.000Z"
    }
  }
  ```

### 5.4 删除笔记
- **URL**：`/notes/:id`
- **方法**：`DELETE`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "message": "笔记删除成功"
  }
  ```

## 6. 标签管理API

### 6.1 获取用户所有标签
- **URL**：`/tags`
- **方法**：`GET`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "tags": ["标签1", "标签2", "标签3"]
    }
  }
  ```

### 6.2 获取标签统计
- **URL**：`/tags/stats`
- **方法**：`GET`
- **认证**：需要JWT token
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "tags": [
        {
          "name": "标签1",
          "count": 5
        },
        {
          "name": "标签2",
          "count": 3
        }
      ]
    }
  }
  ```

## 7. 引用生成API

### 7.1 生成单个文献引用
- **URL**：`/citations/:id`
- **方法**：`GET`
- **认证**：需要JWT token
- **查询参数**：
  - `style`：引用样式，如apa、mla、chicago，默认apa
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "citation": "作者. (年份). 标题. 期刊名称, 卷号(期号), 页码. DOI"
    }
  }
  ```

### 7.2 生成参考文献列表
- **URL**：`/citations/bibliography`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "ids": ["document-id-1", "document-id-2"],
    "style": "apa"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "bibliography": "参考文献列表字符串"
    }
  }
  ```

## 8. DOI导入API

### 8.1 通过DOI导入文献
- **URL**：`/import/doi`
- **方法**：`POST`
- **认证**：需要JWT token
- **请求体**：
  ```json
  {
    "doi": "10.1234/example.2023"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "DOI导入成功",
    "data": {
      "_id": "document-id",
      "title": "string",
      "authors": ["string"],
      "journal": "string",
      "year": 2023,
      "doi": "string",
      "abstract": "string",
      "keywords": ["string"]
    }
  }
  ```

## 9. 响应格式规范

### 9.1 成功响应
```json
{
  "success": true,
  "message": "操作成功",
  "data": {}
}
```

### 9.2 错误响应
```json
{
  "success": false,
  "message": "错误信息",
  "error": {
    "code": "错误代码",
    "details": "错误详情"
  }
}
```

## 10. 状态码说明

- **200 OK**：请求成功
- **201 Created**：资源创建成功
- **204 No Content**：请求成功，但没有返回内容
- **400 Bad Request**：请求参数错误
- **401 Unauthorized**：未认证，需要登录
- **403 Forbidden**：已认证，但没有权限访问该资源
- **404 Not Found**：资源不存在
- **405 Method Not Allowed**：不支持的HTTP方法
- **500 Internal Server Error**：服务器内部错误

## 11. 实现计划

1. **更新路由配置**：创建v1版本的API路由
2. **实现控制器**：根据API设计实现相应的控制器方法
3. **添加中间件**：实现API版本控制和请求验证
4. **更新前端**：修改前端代码以使用新的API端点
5. **测试**：编写单元测试和集成测试
6. **文档**：使用Swagger生成API文档

## 12. 安全性考虑

- **JWT认证**：使用安全的JWT密钥，设置合理的过期时间
- **密码加密**：使用bcryptjs对密码进行加密存储
- **输入验证**：对所有API请求进行参数验证
- **防止SQL注入**：使用Mongoose ORM，避免直接拼接SQL
- **防止XSS攻击**：对用户输入进行转义处理
- **CSRF保护**：实现CSRF令牌机制
- **文件上传安全**：验证文件类型和大小，防止恶意文件上传

## 13. 性能优化

- **数据库索引**：为常用查询字段添加索引
- **分页和限流**：实现分页查询和API限流
- **缓存**：对热点数据进行缓存
- **异步处理**：使用异步方法处理耗时操作
- **CDN加速**：使用CDN加速静态资源和PDF文件访问

---

该API设计覆盖了文献管理系统的核心功能，提供了完整的RESTful接口，便于前后端分离开发和后续功能扩展。